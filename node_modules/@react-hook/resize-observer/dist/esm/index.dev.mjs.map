{"version":3,"file":"index.dev.mjs","sources":["../../src/index.tsx"],"sourcesContent":["import * as React from 'react'\nimport {ResizeObserver, ResizeObserverEntry} from '@juggle/resize-observer'\nimport useLayoutEffect from '@react-hook/passive-layout-effect'\nimport useLatest from '@react-hook/latest'\nimport rafSchd from 'raf-schd'\n\n/**\n * A React hook that fires a callback whenever ResizeObserver detects a change to its size\n *\n * @param target A React ref created by `useRef()` or an HTML element\n * @param callback Invoked with a single `ResizeObserverEntry` any time\n *   the `target` resizes\n */\nfunction useResizeObserver<T extends HTMLElement>(\n  target: React.RefObject<T> | T | null,\n  callback: UseResizeObserverCallback\n): ResizeObserver {\n  const resizeObserver = getResizeObserver()\n  const storedCallback = useLatest(callback)\n\n  useLayoutEffect(() => {\n    let didUnsubscribe = false\n    const targetEl = target && 'current' in target ? target.current : target\n    if (!targetEl) return\n\n    resizeObserver.subscribe(\n      targetEl,\n      (entry: ResizeObserverEntry, observer: ResizeObserver) => {\n        if (didUnsubscribe) return\n        storedCallback.current(entry, observer)\n      }\n    )\n\n    return () => {\n      didUnsubscribe = true\n      resizeObserver.unsubscribe(targetEl)\n    }\n  }, [target, resizeObserver, storedCallback])\n\n  return resizeObserver.observer\n}\n\nfunction createResizeObserver() {\n  const callbacks: Map<any, UseResizeObserverCallback> = new Map()\n  const observer = new ResizeObserver(\n    rafSchd((entries, observer) => {\n      if (entries.length === 1) {\n        callbacks.get(entries[0].target)?.(entries[0], observer)\n      } else {\n        for (let i = 0; i < entries.length; i++) {\n          callbacks.get(entries[i].target)?.(entries[i], observer)\n        }\n      }\n    })\n  )\n\n  return {\n    observer,\n    subscribe(target: HTMLElement, callback: UseResizeObserverCallback) {\n      observer.observe(target)\n      callbacks.set(target, callback)\n    },\n    unsubscribe(target: HTMLElement) {\n      observer.unobserve(target)\n      callbacks.delete(target)\n    },\n  }\n}\n\nlet _resizeObserver: ReturnType<typeof createResizeObserver>\n\nconst getResizeObserver = () =>\n  !_resizeObserver\n    ? (_resizeObserver = createResizeObserver())\n    : _resizeObserver\n\nexport type UseResizeObserverCallback = (\n  entry: ResizeObserverEntry,\n  observer: ResizeObserver\n) => any\n\nexport default useResizeObserver\n"],"names":["useResizeObserver","target","callback","resizeObserver","getResizeObserver","storedCallback","useLatest","useLayoutEffect","didUnsubscribe","targetEl","current","subscribe","entry","observer","unsubscribe","createResizeObserver","callbacks","Map","ResizeObserver","rafSchd","entries","length","get","i","observe","set","unobserve","delete","_resizeObserver"],"mappings":";;;;;AAMA;;;;;;;;AAOA,SAASA,iBAAT,CACEC,MADF,EAEEC,QAFF,EAGkB;AAChB,MAAMC,cAAc,GAAGC,iBAAiB,EAAxC;AACA,MAAMC,cAAc,GAAGC,SAAS,CAACJ,QAAD,CAAhC;AAEAK,EAAAA,eAAe,CAAC,MAAM;AACpB,QAAIC,cAAc,GAAG,KAArB;AACA,QAAMC,QAAQ,GAAGR,MAAM,IAAI,aAAaA,MAAvB,GAAgCA,MAAM,CAACS,OAAvC,GAAiDT,MAAlE;AACA,QAAI,CAACQ,QAAL,EAAe;AAEfN,IAAAA,cAAc,CAACQ,SAAf,CACEF,QADF,EAEE,CAACG,KAAD,EAA6BC,QAA7B,KAA0D;AACxD,UAAIL,cAAJ,EAAoB;AACpBH,MAAAA,cAAc,CAACK,OAAf,CAAuBE,KAAvB,EAA8BC,QAA9B;AACD,KALH;AAQA,WAAO,MAAM;AACXL,MAAAA,cAAc,GAAG,IAAjB;AACAL,MAAAA,cAAc,CAACW,WAAf,CAA2BL,QAA3B;AACD,KAHD;AAID,GAjBc,EAiBZ,CAACR,MAAD,EAASE,cAAT,EAAyBE,cAAzB,CAjBY,CAAf;AAmBA,SAAOF,cAAc,CAACU,QAAtB;AACD;;AAED,SAASE,oBAAT,GAAgC;AAC9B,MAAMC,SAA8C,GAAG,IAAIC,GAAJ,EAAvD;AACA,MAAMJ,QAAQ,GAAG,IAAIK,cAAJ,CACfC,OAAO,CAAC,CAACC,OAAD,EAAUP,QAAV,KAAuB;AAC7B,QAAIO,OAAO,CAACC,MAAR,KAAmB,CAAvB,EAA0B;AAAA;;AACxB,wBAAAL,SAAS,CAACM,GAAV,CAAcF,OAAO,CAAC,CAAD,CAAP,CAAWnB,MAAzB,mEAAmCmB,OAAO,CAAC,CAAD,CAA1C,EAA+CP,QAA/C;AACD,KAFD,MAEO;AACL,WAAK,IAAIU,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGH,OAAO,CAACC,MAA5B,EAAoCE,CAAC,EAArC,EAAyC;AAAA;;AACvC,2BAAAP,SAAS,CAACM,GAAV,CAAcF,OAAO,CAACG,CAAD,CAAP,CAAWtB,MAAzB,qEAAmCmB,OAAO,CAACG,CAAD,CAA1C,EAA+CV,QAA/C;AACD;AACF;AACF,GARM,CADQ,CAAjB;AAYA,SAAO;AACLA,IAAAA,QADK;;AAELF,IAAAA,SAAS,CAACV,MAAD,EAAsBC,QAAtB,EAA2D;AAClEW,MAAAA,QAAQ,CAACW,OAAT,CAAiBvB,MAAjB;AACAe,MAAAA,SAAS,CAACS,GAAV,CAAcxB,MAAd,EAAsBC,QAAtB;AACD,KALI;;AAMLY,IAAAA,WAAW,CAACb,MAAD,EAAsB;AAC/BY,MAAAA,QAAQ,CAACa,SAAT,CAAmBzB,MAAnB;AACAe,MAAAA,SAAS,CAACW,MAAV,CAAiB1B,MAAjB;AACD;;AATI,GAAP;AAWD;;AAED,IAAI2B,eAAJ;;AAEA,IAAMxB,iBAAiB,GAAG,MACxB,CAACwB,eAAD,GACKA,eAAe,GAAGb,oBAAoB,EAD3C,GAEIa,eAHN;;;;"}